# 2. System Architecture

This document defines the architectural principles and design patterns for the Integrated Digital Management System. All code must adhere to this structure to ensure maintainability, scalability, and separation of concerns.

## 1. Core Architectural Pattern

The system follows a simplified **Model-View-Controller (MVC)** pattern:

- **Model:** Represents the data and business logic. This is handled by PHP classes that interact directly with the `MySQL` database. The database schema is the ultimate source of truth for the data model.
- **View:** The user interface, responsible for presenting data to the user. This is composed of `HTML` documents, styled with `CSS` and `Bootstrap`, with dynamic behavior provided by `JavaScript`.
- **Controller:** Handles user input and orchestrates the interaction between the Model and the View. This is managed by server-side `PHP` scripts that process `HTTP` requests, interact with the Models, and determine which View to render.

## 2. User and Role-Based Access Control (RBAC)

The system is built on a strict, role-based architecture inherited from a base `User` class.

- **`User` (Abstract Class):** A foundational class containing common attributes (`UserID`, `Username`, `Email`, etc.).
- **Derived Classes (Roles):**
  - **`Admin`:** Full access to all system functionalities, including financial data, user management, and system settings.
  - **`Staff`:** Restricted, view-only access primarily to operational data like daily tasks and booking schedules. Staff cannot modify or delete critical data.
  - **`Customer`:** Access to self-service functions like creating bookings, managing their own profile, making payments, and submitting feedback.

## 3. Key Entity Relationships

The system's logic revolves around the `Booking` entity. The following relationships, as defined in the class diagrams, are central to the architecture and must be respected:

- **`Customer` to `Booking` (One-to-Many):** A customer can have multiple bookings.
- **`Booking` to `Facility` (Many-to-One):** A booking is for a specific facility.
- **`Booking` to `Payment` (One-to-Many):** A booking can have multiple payment records (e.g., downpayment, full payment).
- **`Booking` to `Feedback` (One-to-One):** A booking can have one associated feedback entry.
- **`Resort` to `Facility` (Composition):** A `Facility` cannot exist without a `Resort`. This is a strong ownership relationship.

## 4. Guiding Principles

- **Separation of Concerns:** Keep business logic (`PHP` Models) separate from presentation (`HTML`/`CSS` Views) and request handling (`PHP` Controllers).
- **Data Integrity:** All data manipulation must go through the Model layer. Direct database queries from Views or Controllers are forbidden.
- **Security:** Implement input validation in the Controller layer and use prepared statements in the Model layer to prevent SQL injection. All access must be checked against the user's role.
- **Modularity:** Group related functionalities into modules (e.g., Booking, Payment, User Management) to keep the codebase organized.
